generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Supervisor {
  id        String    @id @default(uuid())
  name      String
  email     String    @unique
  password  String?
  role      String    @default("SUPERVISOR")
  createdAt DateTime  @default(now())
  sessions  Session[]
}

model Fellow {
  id        String    @id @default(uuid())
  name      String
  createdAt DateTime  @default(now())
  sessions  Session[]
}

model Session {
  id           String        @id @default(uuid())
  date         DateTime
  groupId      String
  transcript   String
  status       SessionStatus @default(PROCESSED)
  supervisorId String
  fellowId     String
  createdAt    DateTime      @default(now())
  aiAnalysis   AIAnalysis?
  fellow       Fellow        @relation(fields: [fellowId], references: [id])
  supervisor   Supervisor    @relation(fields: [supervisorId], references: [id])
}

model AIAnalysis {
  id                String   @id @default(uuid())
  sessionId         String   @unique
  summary           String
  contentScore      Int
  facilitationScore Int
  protocolScore     Int
  justification     String
  riskFlag          RiskFlag
  riskQuote         String?
  validated         Boolean  @default(false)
  supervisorNote    String?
  session           Session  @relation(fields: [sessionId], references: [id])
}

enum SessionStatus {
  PENDING
  PROCESSED
  FLAGGED
  SAFE
}

enum RiskFlag {
  SAFE
  RISK
}
